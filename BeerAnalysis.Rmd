---
title: "Beer Analysis"
author: "Abahay Sharma and Derek Rogers"
date: "2022-10-07"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(dplyr)
library(ggthemes)
library(plotly)
library(ggExtra)
```

```{r}
BeerData = data.frame(read.csv("C:/SMU MS Data Science/DoingDataScience6306/MSDS_6306_Doing-Data-Science/Unit 8 and 9 Case Study 1/Beers.csv"))
BreweriesData = data.frame(read.csv("C:/SMU MS Data Science/DoingDataScience6306/MSDS_6306_Doing-Data-Science/Unit 8 and 9 Case Study 1/Breweries.csv"))

BeerData
BreweriesData
```
```{r}
# Manually add in missing data for beers of interest
BeerData[BeerData$Name == "Lee Hill Series Vol. 5 - Belgian Style Quadrupel Ale",]$IBU = 35
BeerData[BeerData$Name == "Lee Hill Series Vol. 5 - Belgian Style Quadrupel Ale",]
```

```{r}
# Tidy data

BreweriesData$State = as.factor(BreweriesData$State)

exampleSpace = "beer 1 (2015)"
exampleNoSpace = "beer 1(2015)"

str_remove(exampleSpace, "[:space:]\\([:digit:]*.")
str_remove(exampleNoSpace, "\\([:digit:]*.")
```

```{r}
# Tidy data

exampleSpace = "beer 1 (2015)"
exampleNoSpace = "beer 1(2015)"
exampleSpaceOz = "beer 1 (12oz)"
exampleNoSpaceOz = "beer 1(12 oz)"


str_remove(exampleSpace, "([:space:]|)\\(\\d\\d\\d\\d\\)")
str_remove(exampleNoSpace, "([:space:]|)\\(\\d\\d\\d\\d\\)")
str_remove(exampleSpaceOz, "([:space:]|)\\(\\d\\d\\d\\d\\)")
str_remove(exampleNoSpaceOz, "([:space:]|)\\(\\d\\d\\d\\d\\)")
```


```{r}
# Merge beer data with breweries data
names(BreweriesData)[1] = "Brewery_id"
mergedBeerData = merge(BeerData, BreweriesData, by = "Brewery_id")

head(mergedBeerData, 6)
tail(mergedBeerData, 6)
```

```{r}
# Find the beer with the largest ABV and IBU and return those row

"Highest ABV:"
max(mergedBeerData$ABV, na.rm = TRUE)
"Highest IBU:"
max(mergedBeerData$IBU, na.rm = TRUE)

mergedBeerData[which.max(mergedBeerData$ABV),]
mergedBeerData[which.max(mergedBeerData$IBU),]
```

```{r}
# create histogram of the number of breweries in each state

NumberOfBreweriesInEachStateHistogram = ggplot(data = BreweriesData , aes(x=fct_infreq(State))) + 
  geom_bar(stat = "count") + 
  labs(title="Number of Breweries in each State", 
       y="Count", 
       x="State") +
  theme(axis.text.x = element_text(size = rel(0.8), angle = 90))

ggplotly(NumberOfBreweriesInEachStateHistogram)
```

```{r}
# Show a map of the US to show how many breweries are in each state with usmap and ggplot2
library(usmap)
library(ggplot2)


plot_usmap(regions = "states") + labs(title = "U.S States")
```

```{r}
# Show a map of the US to show how many breweries are in each state with plotly
library(plotly)

g = list(scope = 'usa')

fig = plot_geo(BreweriesData, locationmode = 'USA-states') %>%
  add_trace(
    colors = 'purples'
  ) %>%
  colorbar(title = "Number of breweries in each state") %>%
  layout(geo = g)
```

```{r}
# Compute the median alcohol content and international bitterness unit for each state then plot with a bar chart

stateMedianABV = mergedBeerData %>% filter(!is.na(ABV)) %>% group_by(State) %>% summarise(Median = median(ABV)) %>% arrange(desc(Median))
stateMedianIBU = mergedBeerData %>% filter(!is.na(IBU)) %>% group_by(State) %>% summarise(Median = median(IBU)) %>% arrange(desc(Median))

stateMedianABV
stateMedianIBU

stateMedianABVBarPlot = ggplot(data = stateMedianABV, aes(x = reorder(State, -Median), y = Median)) +
  geom_bar(stat = "identity") +
  theme(axis.text.x = element_text(size = rel(0.8), angle = 90)) +
  labs(title="Median ABV by State", 
     y="Median ABV", 
     x="State")

stateMedianIBUBarPlot = ggplot(data = stateMedianIBU, aes(x = reorder(State, -Median), y = Median)) +
  geom_bar(stat = "identity") +
  theme(axis.text.x = element_text(size = rel(0.8), angle = 90)) +
  labs(title="Median IBU by State", 
     y="Median IBU", 
     x="State")

ggplotly(stateMedianABVBarPlot)
ggplotly(stateMedianIBUBarPlot)
```

```{r}
# Summary statistics for ABV variable
summary(mergedBeerData %>% filter(!is.na(ABV)))
```

```{r}
# Boxplot of ABV
scatterPlotABV = ggplot(data = mergedBeerData %>% filter(!is.na(ABV)), aes(x=ABV)) + 
  geom_boxplot() +
  ylim(-1,1) +
  labs(title = "ABV Distrobution", x = "ABV") +
  theme(axis.text.y = element_blank(), axis.ticks.y = element_blank())

plot(scatterPlotABV)
ggplotly(scatterPlotABV)
```

```{r}
# Distribution of the ABV variable
barPlotABV <- ggplot(data = mergedBeerData %>% filter(!is.na(ABV)), aes(x=ABV)) +
  geom_bar(stat = "count") + 
  labs(title="Distribution of ABV", 
       y="Count", 
       x="ABV")

ggplotly(barPlotABV)
```


```{r}
# Scatter plot between IBU and ABV
scatterPlotIBUvsABV = ggplot(data = mergedBeerData %>% filter(!is.na(ABV) & !is.na(IBU)), aes(x=ABV, y=IBU)) + 
  geom_point(position = "jitter") + 
  geom_smooth(method = "loess", se = F) + 
  labs(title = "Relationship between ABV and IBU", 
       y = "IBU", 
       x = "ABV")

plot(scatterPlotIBUvsABV)
ggplotly(scatterPlotIBUvsABV)
ggMarginal(scatterPlotIBUvsABV, type = "histogram")
ggMarginal(scatterPlotIBUvsABV, type = "boxplot")
ggMarginal(scatterPlotIBUvsABV)
```